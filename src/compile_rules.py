#!/usr/bin/python3

import sys
import os
import yara


def main():
    rule_dir = sys.argv[1]

    files = os.listdir(rule_dir)
    yara_files = list(filter(lambda x: x.endswith('.yar'), files))

    rules_dir = {}

    for rule in yara_files:
        rules_dir[rule] = f'{rule_dir}/{rule}'
    
    # {
    #    "rule name": "rule filepath"
    #    "etc"

    rules = yara.compile(filepaths = rules_dir)

    matches = rules.match('0f31b2b43e5a106965f948b8e525211929c3d4d7218c6ee09d28528ab70526a5.elf')
    print(matches)

main()
